function getRandom(t,e){return Math.floor(Math.random()*(e-t)+t)}function getDistance(t,e,i,a){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-a,2))}function isAABBC(t,e,i,a,s,o,r,n){return s+r>t&&t+i>s&&o+n>e&&e+a>o?!0:!1}function inGameView(){return mouseY>fontSize+3*padding?!0:!1}function reset(){clicked=!1,score=0,timer=time/1e3;for(var t=0;t<tsarr.length;t++)tsarr[t].place(),tsarr[t].alive=!0}function touchesIndexById(t){for(var e=0;e<touches.length;e++){var i=touches[e].identifier;if(i==t)return e}return-1}function copyTouch(t){return{identifier:t.identifier,pageX:t.pageX-canvas.offsetLeft,pageY:t.pageY-canvas.offsetTop}}function start(){state=1,startTime=Date.now(),reset(),document.getElementById("playbutton").value="Restart"}function Bush(t,e,i,a){this.x=t,this.y=e,this.radius=i,this.color=a,this.show=!0,this.lastSpawn=Date.now(),this.img=salatpic}var ups=30,devmode=!1,lahmacunmode=!0,time=2e4,targets=5,flyTargets=3,hideTargets=3,targetSpeed=4,bushSpawn=2e3,bushMaxHeight=100,maxRadius=30,minRadius=25,playerRadius=15,font="monospace",fontSize=20,fontColor="#33CC33",color="white",colorHover="#ccffcc",padding=5,uiSize=fontSize+3*padding,canvas=document.getElementById("game"),ctx=canvas.getContext("2d"),displayScore=document.getElementById("score"),displayTimer=document.getElementById("timer"),mouse=!1,mouseX=0,mouseY=0,clicked=!1,touch=!1,touches=[],mousemode=!0,touchmode=!1,score=0,finalScore=0,highscore=0,timer=20,state=0,fps=0,frame=0,timerID=0,startTime=0,fpsCounter=window.setInterval(function(){fps=frame,frame=0},1e3),lahmacunpic=new Image;lahmacunpic.src="img/lahmacun-60x60.png";var salatpic=new Image;salatpic.src="img/salat-60x60.png";var tsarr=[],bsarr=[],lag=0,lagStart=0,hits=0;document.body.clientWidth<canvas.width&&(canvas.width=document.body.clientWidth),canvas.height+canvas.offsetTop>window.innerHeight&&(canvas.height=window.innerHeight-canvas.offsetTop-80);var bushes=Math.floor(canvas.width/minRadius*2);canvas.width<500&&(fontSize=5*canvas.width/100),canvas.addEventListener("mousedown",function(){mousemode=!0,touchmode=!1,mouse=!0},!1),canvas.addEventListener("mouseup",function(){mouse=!1},!1),canvas.addEventListener("mousemove",function(t){mouseX=t.pageX-canvas.offsetLeft,mouseY=t.pageY-canvas.offsetTop},!1),canvas.addEventListener("touchstart",function(t){touchmode=!0,mousemode=!1,touch=!0;for(var e=0;e<t.changedTouches.length;e++)touches.push({identifier:t.changedTouches[e].identifier,pageX:t.changedTouches[e].pageX-canvas.offsetLeft,pageY:t.changedTouches[e].pageY-canvas.offsetTop})},!1),canvas.addEventListener("touchend",function(t){touch=!1;for(var e=-1,i=0;i<t.changedTouches.length;i++)e=touchesIndexById(t.changedTouches[i].identifier),e>=0&&touches.splice(e,1)},!1);var Target=function(){this.x=0,this.y=0,this.vy=0,this.vx=0,this.img=lahmacunpic,this.radius=lahmacunpic.width/2,this.speed=targetSpeed,this.alive=!0};Target.prototype.draw=function(){lahmacunmode?ctx.drawImage(this.img,this.x-this.radius,this.y-this.radius):(ctx.fillStyle="blue",ctx.beginPath(),ctx.arc(this.x,this.y,this.radius,0,2*Math.PI,!0),ctx.fill(),ctx.fillStyle="white",ctx.beginPath(),ctx.arc(this.x,this.y,this.radius/2,0,2*Math.PI,!0),ctx.fill())},Target.prototype.isHit=function(){if(mouse&&inGameView()&&clicked&&getDistance(mouseX,mouseY,this.x,this.y)<=this.radius+playerRadius)return this.alive=!1,score++,hits++,!0;for(var t=0;t<touches.length;t++)if(touch&&inGameView()&&clicked&&getDistance(touches[t].pageX,touches[t].pageY,this.x,this.y)<=this.radius+playerRadius)return this.alive=!1,score++,hits++,!0;return!1},Target.prototype.shareUpdate=function(){this.alive?this.update():(this.speed*=1.1,this.vy=4*-this.speed,this.y<=-this.radius&&(this.vy=0,this.place())),this.x+=this.vx,this.y+=this.vy};var FlyTarget=function(){};FlyTarget.prototype=new Target,FlyTarget.prototype.update=function(){this.x-this.radius>canvas.width&&this.place()},FlyTarget.prototype.place=function(){this.alive=!0,this.vy=0,this.speed=targetSpeed,this.vx=this.speed,this.x=getRandom(-this.radius,-(canvas.width/2)),this.y=getRandom(this.radius+fontSize+3*padding,canvas.height-this.radius-bushMaxHeight)};var HideTarget=function(){};HideTarget.prototype=new Target,HideTarget.prototype.update=function(){this.y<canvas.height-bushMaxHeight&&(this.speed*=1.1,this.vy=this.speed),this.vy>0&&this.y>canvas.height+2*this.radius&&this.place()},HideTarget.prototype.place=function(){this.alive=!0,this.speed=targetSpeed,this.vy=-(.4*this.speed),this.x=getRandom(this.radius,canvas.width-this.radius),this.y=getRandom(canvas.height+this.radius,canvas.height+this.radius+bushMaxHeight)},Bush.prototype.draw=function(){this.show&&ctx.drawImage(this.img,this.x-this.radius,this.y-this.radius)},Bush.prototype.update=function(){Date.now()-this.lastSpawn>=bushSpawn&&(this.show=!0),mousemode&&this.show&&mouse&&clicked&&getDistance(mouseX,mouseY,this.x,this.y)<=this.radius+playerRadius&&(this.show=!1,hits++,this.lastSpawn=Date.now());for(var t=0;t<touches.length;t++)touch&&inGameView()&&clicked&&getDistance(touches[t].pageX,touches[t].pageY,this.x,this.y)<=this.radius+playerRadius&&(this.show=!1,hits++,this.lastSpawn=Date.now())};for(var states={shareUpdate:function(){mouse&&mousemode&&(clicked=!1),!mouse&&mousemode&&(clicked=!0),touch&&touchmode&&(clicked=!1),!touch&&touchmode&&(clicked=!0),displayTimer.innerHTML=timer,displayScore.innerHTML=score},update:[function(){tsarr[flyTargets].shareUpdate();for(var t=0;t<bsarr.length;t++)bsarr[t].update();score=finalScore},function(){for(var t=0;t<tsarr.length;t++)tsarr[t].alive&&tsarr[t].isHit(),tsarr[t].shareUpdate();for(var t=0;t<bsarr.length;t++)bsarr[t].update();(mouse||touch)&&inGameView()&&clicked&&0>=hits&&score--,hits=0,timer=Math.floor((time-(Date.now()-startTime))/1e3),0>=timer&&(finalScore=score,finalScore>highscore&&(highscore=finalScore),state=0,reset(),document.getElementById("playbutton").value="Play")}],shareRenderAfter:function(){for(var t=0;t<bsarr.length;t++)bsarr[t].show&&bsarr[t].draw();if(devmode){ctx.fillStyle="red",ctx.font=.8*fontSize+"px "+font,ctx.fillText("FPS: "+fps,5,uiSize+25),ctx.font=.5*fontSize+"px "+font,ctx.fillText("X: "+mouseX,5,uiSize+.8*fontSize+25),ctx.fillText("Y: "+mouseY,5,uiSize+.8*fontSize+35),ctx.fillText("Mouse: "+mouse,5,uiSize+.8*fontSize+45),ctx.fillText("Clicked: "+clicked,5,uiSize+.8*fontSize+55),ctx.fillText("Lag: "+lag+" ms",5,uiSize+.8*fontSize+65),ctx.fillText("Touch: "+touch,5,uiSize+.8*fontSize+75),ctx.fillText("Mousemode: "+mousemode,5,uiSize+.8*fontSize+85),ctx.fillText("Touchmode: "+touchmode,5,uiSize+.8*fontSize+95);for(var t=0;t<touches.length;t++)ctx.fillText("Touches["+t+"]: { ID:"+touches[t].identifier+", X:"+touches[t].pageX+", Y:"+touches[t].pageY+" }",5,uiSize+.8*fontSize+105+10*t),ctx.fillStyle="rgba(255,0,0,0.3)",ctx.beginPath(),ctx.arc(touches[t].pageX,touches[t].pageY,playerRadius,0,2*Math.PI,!0),ctx.fill();0!=mouseY&&0!=mouseX&&(ctx.fillStyle="rgba(255,0,0,0.3)",ctx.beginPath(),ctx.arc(mouseX,mouseY,playerRadius,0,2*Math.PI,!0),ctx.fill()),tsarr.forEach(function(t,e,i){ctx.strokeStyle="red",ctx.beginPath(),ctx.moveTo(mouseX,mouseY),ctx.lineTo(t.x,t.y),ctx.stroke()})}},render:[function(){tsarr[flyTargets].draw(),ctx.fillStyle=color,ctx.fillRect(0,canvas.height/2-1.3*fontSize-fontSize,canvas.width,1.3*fontSize+3*padding),ctx.fillStyle=fontColor,ctx.font=1.3*fontSize+"px "+font,ctx.fillText("Your Highscore: "+highscore,padding,canvas.height/2+padding-fontSize)},function(){for(var t=0;t<tsarr.length;t++)tsarr[t].draw()}]},i=0;flyTargets>i;i++)tsarr[i]=new FlyTarget,tsarr[i].place();for(var i=flyTargets;hideTargets+flyTargets>i;i++)tsarr[i]=new HideTarget,tsarr[i].place();for(var i=0,w=0,r=1;bushes>i;i++,w++)i==Math.floor(bushes/2)&&(w=0,r++),bsarr[i]=new Bush(w*maxRadius,canvas.height-minRadius*r,getRandom(1.2*minRadius,maxRadius),"rgb("+getRandom(50,100)+","+getRandom(225,255)+","+getRandom(50,100)+")");var updateID=window.setInterval(function(){lagStart=Date.now(),states.update[state](),states.shareUpdate(),lag=Date.now()-lagStart},1e3/ups);!function t(){ctx.clearRect(0,0,canvas.width,canvas.height),states.render[state](),states.shareRenderAfter(),frame++,window.requestAnimationFrame(t)}();
